<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI-Enhanced Prompt Generator</title>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            primary: '#5D5CDE',
          },
        },
      },
    }
    
    // Check for dark mode preference
    if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
      document.documentElement.classList.add('dark');
    }
    
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
      if (event.matches) {
        document.documentElement.classList.add('dark');
      } else {
        document.documentElement.classList.remove('dark');
      }
    });
  </script>
</head>
<body class="bg-white dark:bg-gray-900 min-h-screen">
  <div id="root"></div>
  
  <script type="text/babel">
    // Cookie utility functions
    const setCookie = (name, value, days = 365) => {
      const date = new Date();
      date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
      const expires = `expires=${date.toUTCString()}`;
      document.cookie = `${name}=${value};${expires};path=/;SameSite=Strict`;
    };

    const getCookie = (name) => {
      const cookieName = `${name}=`;
      const cookies = document.cookie.split(';');
      for (let i = 0; i < cookies.length; i++) {
        let cookie = cookies[i].trim();
        if (cookie.indexOf(cookieName) === 0) {
          return cookie.substring(cookieName.length, cookie.length);
        }
      }
      return "";
    };

    const App = () => {
      // Add favorites and history functionality
      const [favorites, setFavorites] = React.useState(() => {
        const saved = localStorage.getItem('prompt_favorites');
        return saved ? JSON.parse(saved) : [];
      });
      
      const [promptHistory, setPromptHistory] = React.useState(() => {
        const saved = localStorage.getItem('prompt_history');
        return saved ? JSON.parse(saved) : [];
      });
      
      // UI state for tabs and modals
      const [activeTab, setActiveTab] = React.useState('generator'); // 'generator', 'favorites', 'history'
      const [showCustomModal, setShowCustomModal] = React.useState(false);
      const [customType, setCustomType] = React.useState(''); // 'role', 'task', 'format'
      const [customValue, setCustomValue] = React.useState('');
      const [showPreview, setShowPreview] = React.useState(false);
      const [previewResponse, setPreviewResponse] = React.useState('');
      const [isLoadingPreview, setIsLoadingPreview] = React.useState(false);
      
      const roles = [
        "Marketer", "Advertiser", "Mindset Coach", "Best Selling Author", 
        "Therapist", "Website Designer", "Journalist", "Inventor", 
        "Chief Financial Officer", "Copywriter", "Prompt Engineer", 
        "Accountant", "Lawyer", "Analyst", "Ghostwriter", 
        "Project Manager", "Professor at a university"
      ];
      
      const tasks = [
        "Headline", "Article", "Essay", "Book Outline", "Email Sequence", 
        "Social Media Post", "Product Description", "Cover Letter", 
        "Blog Post", "SEO Keywords", "Summary", "Video Script", 
        "Recipe", "Sales Copy", "Analysis", "Ad Copy"
      ];
      
      const formats = [
        "A Table", "A List", "Summary", "HTML", "Code", "Spreadsheet", 
        "Graphs", "CSV file", "Plain Text file", "JSON", "Rich Text", 
        "PDF", "XML", "Markdown", "Gantt Chart", "Word Cloud"
      ];
      
      // Add storage for custom options
      const [customRoles, setCustomRoles] = React.useState(() => {
        const saved = getCookie('custom_roles');
        return saved ? JSON.parse(saved) : [];
      });
      
      const [customTasks, setCustomTasks] = React.useState(() => {
        const saved = getCookie('custom_tasks');
        return saved ? JSON.parse(saved) : [];
      });
      
      const [customFormats, setCustomFormats] = React.useState(() => {
        const saved = getCookie('custom_formats');
        return saved ? JSON.parse(saved) : [];
      });
      
      // Combine default and custom options
      const allRoles = React.useMemo(() => [...roles, ...customRoles], [customRoles]);
      const allTasks = React.useMemo(() => [...tasks, ...customTasks], [customTasks]);
      const allFormats = React.useMemo(() => [...formats, ...customFormats], [customFormats]);
      
      const models = [
        {
          id: "anthropic/claude-3-haiku",
          name: "Claude 3 Haiku",
          description: "Fast and cost-effective model with solid reasoning"
        },
        {
          id: "anthropic/claude-3-sonnet",
          name: "Claude 3 Sonnet",
          description: "Balanced model with excellent reasoning and creativity"
        },
        {
          id: "anthropic/claude-3-opus",
          name: "Claude 3 Opus",
          description: "Most powerful Claude model with exceptional reasoning"
        },
        {
          id: "openai/gpt-4o",
          name: "GPT-4o",
          description: "OpenAI's flagship model with strong general capabilities"
        },
        {
          id: "openai/gpt-4o-mini",
          name: "GPT-4o Mini",
          description: "Smaller, faster version of GPT-4o"
        },
        {
          id: "google/gemini-1.5-pro",
          name: "Gemini 1.5 Pro",
          description: "Google's advanced model with strong reasoning abilities"
        },
        {
          id: "mistralai/mistral-large",
          name: "Mistral Large",
          description: "Powerful and efficient model from Mistral AI"
        }
      ];
      
      // Get saved settings from cookies
      const savedApiKey = React.useMemo(() => getCookie('openrouter_api_key'), []);
      const savedModel = React.useMemo(() => {
        const modelId = getCookie('selected_model');
        return modelId && models.some(m => m.id === modelId) ? modelId : models[0].id;
      }, []);
      
      const [selectedRole, setSelectedRole] = React.useState("");
      const [selectedTask, setSelectedTask] = React.useState("");
      const [selectedFormat, setSelectedFormat] = React.useState("");
      const [seedPrompt, setSeedPrompt] = React.useState("");
      const [enhancedPrompt, setEnhancedPrompt] = React.useState("");
      const [isLoading, setIsLoading] = React.useState(false);
      const [apiKey, setApiKey] = React.useState(savedApiKey || "");
      const [error, setError] = React.useState("");
      const [copySuccess, setCopySuccess] = React.useState(false);
      const [selectedModel, setSelectedModel] = React.useState(savedModel);
      const [modelInfo, setModelInfo] = React.useState(
        models.find(model => model.id === savedModel)?.description || models[0].description
      );
      const [settingsSaved, setSettingsSaved] = React.useState(!!savedApiKey);
      
      // Functions for handling favorites
      const addToFavorites = () => {
        const prompt = enhancedPrompt || generatedPrompt;
        if (!prompt) return;
        
        const newFavorite = {
          id: Date.now(),
          prompt,
          role: selectedRole,
          task: selectedTask,
          format: selectedFormat,
          seed: seedPrompt,
          date: new Date().toISOString(),
          previewResponse: previewResponse || "" // Store the preview response if available
        };
        
        const updatedFavorites = [...favorites, newFavorite];
        setFavorites(updatedFavorites);
        localStorage.setItem('prompt_favorites', JSON.stringify(updatedFavorites));
      };
      
      const removeFromFavorites = (id) => {
        const updatedFavorites = favorites.filter(fav => fav.id !== id);
        setFavorites(updatedFavorites);
        localStorage.setItem('prompt_favorites', JSON.stringify(updatedFavorites));
      };
      
      // Function to load a favorite or historical prompt
      const loadSavedPrompt = (item) => {
        setSelectedRole(item.role || "");
        setSelectedTask(item.task || "");
        setSelectedFormat(item.format || "");
        setSeedPrompt(item.seed || "");
        setEnhancedPrompt(item.prompt || "");
        setActiveTab('generator');
      };
      
      // Function to remove an item from history
      const removeFromHistory = (id) => {
        const updatedHistory = promptHistory.filter(item => item.id !== id);
        setPromptHistory(updatedHistory);
        localStorage.setItem('prompt_history', JSON.stringify(updatedHistory));
      };
      
      // Add custom field (role, task, format)
      const addCustomField = () => {
        if (!customValue.trim()) return;
        
        let updatedList;
        if (customType === 'role') {
          updatedList = [...customRoles, customValue];
          setCustomRoles(updatedList);
          setCookie('custom_roles', JSON.stringify(updatedList));
        } else if (customType === 'task') {
          updatedList = [...customTasks, customValue];
          setCustomTasks(updatedList);
          setCookie('custom_tasks', JSON.stringify(updatedList));
        } else if (customType === 'format') {
          updatedList = [...customFormats, customValue];
          setCustomFormats(updatedList);
          setCookie('custom_formats', JSON.stringify(updatedList));
        }
        
        setCustomValue('');
        setShowCustomModal(false);
      };
      
      // Save to history when enhancing or copying
      React.useEffect(() => {
        if (enhancedPrompt) {
          const historyItem = {
            id: Date.now(),
            prompt: enhancedPrompt,
            role: selectedRole,
            task: selectedTask,
            format: selectedFormat,
            seed: seedPrompt,
            date: new Date().toISOString(),
            previewResponse: previewResponse || "" // Store preview response with history items
          };
          
          // Limit history to 20 items
          const updatedHistory = [historyItem, ...promptHistory].slice(0, 20);
          setPromptHistory(updatedHistory);
          localStorage.setItem('prompt_history', JSON.stringify(updatedHistory));
        }
      }, [enhancedPrompt]);
      
      // Preview function
      const generatePreview = async () => {
        if (!apiKey) {
          setError("Please enter your OpenRouter API key in the API Settings section and save it.");
          return;
        }
        
        const promptToPreview = enhancedPrompt || generatedPrompt;
        if (!promptToPreview) {
          setError("Please generate a prompt to preview first.");
          return;
        }
        
        setIsLoadingPreview(true);
        setError("");
        
        try {
          const response = await fetch('https://openrouter.ai/api/v1/chat/completions', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Authorization': `Bearer ${apiKey}`,
              'HTTP-Referer': window.location.href,
              'X-Title': 'Prompt Generator App'
            },
            body: JSON.stringify({
              model: selectedModel,
              messages: [
                {
                  role: "user",
                  content: promptToPreview
                }
              ],
              max_tokens: 300
            })
          });
          
          if (!response.ok) {
            const errorData = await response.json().catch(() => ({}));
            throw new Error(
              errorData.error?.message || 
              `API error: ${response.status} ${response.statusText}`
            );
          }
          
          const data = await response.json();
          setPreviewResponse(data.choices[0].message.content);
          setShowPreview(true);
        } catch (err) {
          console.error('Error generating preview:', err);
          setError(`Error generating preview: ${err.message}`);
        } finally {
          setIsLoadingPreview(false);
        }
      };
      
      // Export prompts as JSON
      const exportPrompts = (type) => {
        const data = type === 'favorites' ? favorites : promptHistory;
        const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `${type}_${new Date().toISOString().split('T')[0]}.json`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      };
      
      // Update model info when model changes
      const handleModelChange = (modelId) => {
        setSelectedModel(modelId);
        const selectedModelInfo = models.find(model => model.id === modelId);
        setModelInfo(selectedModelInfo?.description || "");
        setSettingsSaved(false);
      };
      
      // Save settings to cookies
      const saveSettings = () => {
        setCookie('openrouter_api_key', apiKey);
        setCookie('selected_model', selectedModel);
        setSettingsSaved(true);
      };
      
      // Generate the basic prompt based on selections
      const generatedPrompt = React.useMemo(() => {
        if (!selectedRole && !selectedTask && !selectedFormat && !seedPrompt) {
          return "";
        }
        
        let prompt = "Acting as a";
        if (selectedRole) {
          prompt += ` ${selectedRole}`;
        } else {
          prompt += " [ROLE]";
        }
        
        prompt += ", perform";
        if (selectedTask) {
          prompt += ` ${selectedTask}`;
        } else {
          prompt += " [TASK]";
        }
        
        prompt += " in";
        if (selectedFormat) {
          prompt += ` ${selectedFormat}`;
        } else {
          prompt += " [FORMAT]";
        }
        
        if (seedPrompt) {
          prompt += `. Seed prompt: ${seedPrompt}`;
        }
        
        return prompt;
      }, [selectedRole, selectedTask, selectedFormat, seedPrompt]);
      
      // Function to get enhanced prompt from OpenRouter
      const enhancePromptWithAI = async () => {
        if (!apiKey) {
          setError("Please enter your OpenRouter API key in the API Settings section and save it.");
          return;
        }
        
        if (!generatedPrompt) {
          setError("Please fill in at least one field before enhancing the prompt.");
          return;
        }
        
        setIsLoading(true);
        setError("");
        
        try {
          // Get the selected model from the state
          const modelId = selectedModel;
          
          // Save the current settings if they aren't already saved
          if (!settingsSaved) {
            saveSettings();
          }
          
          const response = await fetch('https://openrouter.ai/api/v1/chat/completions', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Authorization': `Bearer ${apiKey}`,
              'HTTP-Referer': window.location.href,
              'X-Title': 'Prompt Generator App'
            },
            body: JSON.stringify({
              model: modelId,
              messages: [
                {
                  role: "system",
                  content: "You are a prompt engineering expert. Your task is to improve and refine the user's prompt to make it clearer, more specific, and more likely to generate high-quality responses. Maintain the original intent but make it more effective."
                },
                {
                  role: "user",
                  content: `Please enhance this prompt while maintaining its structure and intent: ${generatedPrompt}`
                }
              ],
              max_tokens: 500
            })
          });
          
          if (!response.ok) {
            const errorData = await response.json().catch(() => ({}));
            throw new Error(
              errorData.error?.message || 
              `API error: ${response.status} ${response.statusText}`
            );
          }
          
          const data = await response.json();
          setEnhancedPrompt(data.choices[0].message.content);
        } catch (err) {
          console.error('Error enhancing prompt:', err);
          setError(`Error enhancing prompt: ${err.message}`);
        } finally {
          setIsLoading(false);
        }
      };
      
      // Copy to clipboard functionality
      const copyToClipboard = async () => {
        const textToCopy = enhancedPrompt || generatedPrompt;
        try {
          await navigator.clipboard.writeText(textToCopy);
          setCopySuccess(true);
          setTimeout(() => setCopySuccess(false), 2000);
        } catch (err) {
          console.error('Failed to copy text: ', err);
        }
      };
      
      // Add the validation function
      const validateResponse = () => {
        const promptText = document.getElementById('validate-prompt').value.trim();
        const responseText = document.getElementById('validate-response').value.trim();
        
        // Check if both prompt and response are provided
        if (!promptText || !responseText) {
          setError("Please provide both a prompt and a response to validate.");
          return;
        }
        
        // Get selected validation criteria
        const factualAccuracyChecked = document.getElementById('factual-accuracy').checked;
        const relevanceChecked = document.getElementById('relevance').checked;
        const biasChecked = document.getElementById('bias').checked;
        const consistencyChecked = document.getElementById('consistency').checked;
        const clarityChecked = document.getElementById('clarity').checked;
        const hallucinationChecked = document.getElementById('hallucination').checked;
        
        // Prepare validation request using the same API as for prompt enhancement
        setIsLoading(true);
        setError("");
        
        fetch('https://openrouter.ai/api/v1/chat/completions', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${apiKey}`,
            'HTTP-Referer': window.location.href,
            'X-Title': 'Prompt Generator App'
          },
          body: JSON.stringify({
            model: selectedModel,
            messages: [
              {
                role: "system",
                content: `You are a prompt evaluation expert who analyzes LLM responses against prompts. 
                Evaluate the response based on the following criteria:
                ${factualAccuracyChecked ? '- Factual Accuracy: Check for factual errors or inaccuracies in the response.' : ''}
                ${relevanceChecked ? '- Relevance: Determine how well the response addresses the prompt.' : ''}
                ${biasChecked ? '- Bias: Identify any potential biases in the response.' : ''}
                ${consistencyChecked ? '- Internal Consistency: Check for logical contradictions within the response.' : ''}
                ${clarityChecked ? '- Clarity & Coherence: Evaluate how clear and well-structured the response is.' : ''}
                ${hallucinationChecked ? '- Hallucination Detection: Identify any made-up information not supported by facts.' : ''}
                
                Rate each criterion on a scale of 1-10 with a brief explanation. Then provide 2-3 specific recommendations to improve the prompt.
                Format your response as JSON with the following structure:
                {
                  "scores": {
                    ${factualAccuracyChecked ? '"factualAccuracy": {"score": N, "explanation": "..."},' : ''}
                    ${relevanceChecked ? '"relevance": {"score": N, "explanation": "..."},' : ''}
                    ${biasChecked ? '"bias": {"score": N, "explanation": "..."},' : ''}
                    ${consistencyChecked ? '"consistency": {"score": N, "explanation": "..."},' : ''}
                    ${clarityChecked ? '"clarity": {"score": N, "explanation": "..."},' : ''}
                    ${hallucinationChecked ? '"hallucination": {"score": N, "explanation": "..."},' : ''}
                  },
                  "overallScore": N,
                  "recommendations": ["rec1", "rec2", "rec3"]
                }`
              },
              {
                role: "user",
                content: `Prompt: ${promptText}\n\nResponse: ${responseText}`
              }
            ],
            max_tokens: 1000,
            response_format: { type: "json_object" }
          })
        })
        .then(response => {
          if (!response.ok) {
            throw new Error(`API error: ${response.status} ${response.statusText}`);
          }
          return response.json();
        })
        .then(data => {
          try {
            const validationResult = JSON.parse(data.choices[0].message.content);
            displayValidationResults(validationResult);
          } catch (err) {
            console.error('Error parsing validation results:', err);
            setError('Error processing validation results. Please try again.');
          }
        })
        .catch(err => {
          console.error('Validation error:', err);
          setError(`Error during validation: ${err.message}`);
        })
        .finally(() => {
          setIsLoading(false);
        });
      };
      
      // Function to display validation results
      const displayValidationResults = (results) => {
        const resultsContainer = document.getElementById('results-container');
        const recommendationsList = document.getElementById('recommendations-list');
        const validationResults = document.getElementById('validation-results');
        
        // Clear previous results
        resultsContainer.innerHTML = '';
        recommendationsList.innerHTML = '';
        
        // Ensure overall score is properly formatted and capped at 10
        const overallScore = typeof results.overallScore === 'number'
          ? Math.min(Math.round(results.overallScore), 10)
          : parseInt(results.overallScore, 10) || 0;
        
        // Add overall score
        const overallScoreEl = document.createElement('div');
        overallScoreEl.className = 'mb-4 flex items-center';
        overallScoreEl.innerHTML = `
          <div class="text-2xl font-bold mr-3 text-primary">${overallScore}/10</div>
          <div class="flex-1">
            <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2.5">
              <div class="bg-primary h-2.5 rounded-full" style="width: ${overallScore * 10}%"></div>
            </div>
            <div class="text-sm mt-1 text-gray-600 dark:text-gray-400">Overall Score</div>
          </div>
        `;
        resultsContainer.appendChild(overallScoreEl);
        
        // Add individual scores
        Object.entries(results.scores).forEach(([criterion, data]) => {
          if (!data) return;
          
          const criterionEl = document.createElement('div');
          criterionEl.className = 'mb-3 p-3 bg-gray-50 dark:bg-gray-900 rounded-lg';
          
          let criterionName = criterion.replace(/([A-Z])/g, ' $1')
            .replace(/^./, str => str.toUpperCase());
          
          criterionEl.innerHTML = `
            <div class="flex items-center justify-between mb-1">
              <div class="font-medium">${criterionName}</div>
              <div class="text-sm font-semibold ${getScoreColorClass(data.score)}">
                ${data.score}/10
              </div>
            </div>
            <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-1.5 mb-2">
              <div class="bg-primary h-1.5 rounded-full" style="width: ${data.score * 10}%"></div>
            </div>
            <div class="text-sm text-gray-700 dark:text-gray-300">
              ${data.explanation}
            </div>
          `;
          resultsContainer.appendChild(criterionEl);
        });
        
        // Add recommendations
        if (results.recommendations && results.recommendations.length > 0) {
          results.recommendations.forEach(recommendation => {
            const li = document.createElement('li');
            li.textContent = recommendation;
            li.className = 'text-sm';
            recommendationsList.appendChild(li);
          });
        }
        
        // Show results container
        validationResults.classList.remove('hidden');
      };
      
      // Helper function for score color classes
      const getScoreColorClass = (score) => {
        if (score >= 8) return 'text-green-600 dark:text-green-400';
        if (score >= 6) return 'text-yellow-600 dark:text-yellow-400';
        return 'text-red-600 dark:text-red-400';
      };
      
      // Dropdown component for reusability
      const Dropdown = ({ label, options, value, onChange }) => (
        <div className="mb-4">
          <label className="block text-gray-700 dark:text-gray-200 text-sm font-bold mb-2">
            {label}
          </label>
          <div className="relative">
            <select
              value={value}
              onChange={(e) => onChange(e.target.value)}
              className="block appearance-none w-full bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-700 text-gray-700 dark:text-gray-200 py-3 px-4 pr-8 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent text-base"
            >
              <option value="">Select {label}</option>
              {options.map((option) => (
                <option key={option} value={option}>
                  {option}
                </option>
              ))}
            </select>
            <div className="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700 dark:text-gray-200">
              <svg className="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
                <path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z" />
              </svg>
            </div>
          </div>
        </div>
      );
      
      // Tab button component
      const TabButton = ({ active, onClick, children }) => (
        <button
          onClick={onClick}
          className={`px-4 py-2 font-medium transition-colors ${
            active 
              ? 'bg-primary text-white' 
              : 'bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700'
          } rounded-lg`}
        >
          {children}
        </button>
      );
      
      // Prompt card component for favorites and history
      const PromptCard = ({ item, isFavorite, onLoad, onToggleFavorite, onDelete, isHistory }) => {
        const date = new Date(item.date).toLocaleDateString();
        
        return (
          <div className="bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700 mb-4">
            <div className="mb-2 flex justify-between items-start">
              <div>
                {item.role && <span className="inline-block bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 text-xs px-2 py-1 rounded mr-2 mb-2">{item.role}</span>}
                {item.task && <span className="inline-block bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 text-xs px-2 py-1 rounded mr-2 mb-2">{item.task}</span>}
                {item.format && <span className="inline-block bg-purple-100 dark:bg-purple-900 text-purple-800 dark:text-purple-200 text-xs px-2 py-1 rounded mb-2">{item.format}</span>}
              </div>
              <span className="text-xs text-gray-500 dark:text-gray-400">{date}</span>
            </div>
            <div className="bg-gray-100 dark:bg-gray-700 p-3 rounded text-gray-800 dark:text-gray-200 text-sm mb-3 max-h-32 overflow-y-auto">
              {item.prompt}
            </div>
            <div className="flex justify-between">
              <div className="flex space-x-3">
                <button
                  onClick={() => onLoad(item)}
                  className="text-primary hover:text-primary/80 text-sm font-medium"
                >
                  Use This Prompt
                </button>
                <button
                  onClick={() => {
                    // First change the tab
                    setActiveTab('validate');
                    
                    // Use setTimeout to ensure the elements are rendered before trying to access them
                    setTimeout(() => {
                      const promptField = document.getElementById('validate-prompt');
                      const responseField = document.getElementById('validate-response');
                      
                      if (promptField) {
                        promptField.value = item.prompt || '';
                      }
                      
                      // Make sure we check if the response field exists AND if the item has a previewResponse property
                      if (responseField) {
                        // Even if previewResponse is empty string or undefined, still set it
                        // This allows clearing the field when there's no response
                        responseField.value = item.previewResponse || '';
                        
                        // Force the browser to register the change
                        const event = new Event('input', { bubbles: true });
                        responseField.dispatchEvent(event);
                      }
                    }, 100);
                  }}
                  className="text-green-600 hover:text-green-700 dark:text-green-400 dark:hover:text-green-300 text-sm font-medium"
                >
                  Validate
                </button>
                {isHistory && onDelete && (
                  <button
                    onClick={() => onDelete(item.id)}
                    className="text-red-600 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300 text-sm font-medium"
                  >
                    Delete
                  </button>
                )}
              </div>
              <button
                onClick={() => onToggleFavorite(item)}
                className="text-sm font-medium flex items-center"
              >
                {isFavorite ? (
                  <span className="text-yellow-500 hover:text-yellow-600">â˜… Favorited</span>
                ) : (
                  <span className="text-gray-500 hover:text-yellow-500">â˜† Add to Favorites</span>
                )}
              </button>
            </div>
          </div>
        );
      };
      
      return (
        <div className="container mx-auto px-4 py-8 max-w-3xl">
          <div className="flex justify-between items-center mb-8">
            <h1 className="text-3xl font-bold text-gray-800 dark:text-white">
              AI-Enhanced Prompt Generator
            </h1>
            <a 
              href="https://intelda-consultant.github.io/projects/prompt-generator.html" 
              className="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors"
              target="_blank"
            >
              ðŸ“– Tutorial
            </a>
          </div>
          
          {/* Tab Navigation */}
          <div className="flex space-x-2 mb-6 overflow-x-auto">
            <TabButton 
              active={activeTab === 'generator'} 
              onClick={() => setActiveTab('generator')}
            >
              Generator
            </TabButton>
            <TabButton 
              active={activeTab === 'favorites'} 
              onClick={() => setActiveTab('favorites')}
            >
              Favorites {favorites.length > 0 && `(${favorites.length})`}
            </TabButton>
            <TabButton 
              active={activeTab === 'history'} 
              onClick={() => setActiveTab('history')}
            >
              History {promptHistory.length > 0 && `(${promptHistory.length})`}
            </TabButton>
            <TabButton 
              active={activeTab === 'validate'} 
              onClick={() => setActiveTab('validate')}
            >
              Validate
            </TabButton>
          </div>
          
          {/* Generator Tab Content */}
          {activeTab === 'generator' && (
          <div className="bg-white dark:bg-gray-800 rounded-xl shadow-md p-6 mb-6">
            <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
              <Dropdown 
                label="ROLE" 
                options={allRoles} 
                value={selectedRole} 
                onChange={setSelectedRole} 
              />
              
              <Dropdown 
                label="TASK" 
                options={allTasks} 
                value={selectedTask} 
                onChange={setSelectedTask} 
              />
              
              <Dropdown 
                label="FORMAT" 
                options={allFormats} 
                value={selectedFormat} 
                onChange={setSelectedFormat} 
              />
            </div>
            
            <div className="mt-4">
              <label className="block text-gray-700 dark:text-gray-200 text-sm font-bold mb-2">
                Seed Prompt
              </label>
              <textarea
                value={seedPrompt}
                onChange={(e) => setSeedPrompt(e.target.value)}
                placeholder="Enter your seed prompt here..."
                className="w-full bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-700 text-gray-700 dark:text-gray-200 py-3 px-4 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent text-base min-h-[100px]"
              />
            </div>
          </div>
          )}
          
          {activeTab === 'generator' && (
          <div className="bg-white dark:bg-gray-800 rounded-xl shadow-md p-6 mb-6">
            <div className="flex justify-between items-center mb-4">
              <h2 className="text-xl font-semibold text-gray-800 dark:text-white">
                API Settings
              </h2>
              {settingsSaved && (
                <span className="px-2 py-1 bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200 text-xs font-medium rounded-full">
                  Saved
                </span>
              )}
            </div>
            
            <div className="mb-4">
              <label className="block text-gray-700 dark:text-gray-200 text-sm font-bold mb-2">
                OpenRouter API Key
              </label>
              <div className="flex">
                <input
                  type="password"
                  value={apiKey}
                  onChange={(e) => setApiKey(e.target.value)}
                  placeholder="Enter your OpenRouter API key"
                  className="flex-1 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-700 text-gray-700 dark:text-gray-200 py-3 px-4 rounded-l-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent text-base"
                />
                <button
                  onClick={() => {
                    setCookie('openrouter_api_key', apiKey);
                    setCookie('selected_model', selectedModel);
                    setSettingsSaved(true);
                  }}
                  className="bg-green-500 hover:bg-green-600 text-white font-medium py-3 px-4 rounded-r-lg transition-colors"
                >
                  Save
                </button>
              </div>
              <div className="mt-2 text-sm text-gray-500 dark:text-gray-400">
                Your API key is stored in a cookie on your device for convenience.
              </div>
            </div>
            
            <div>
              <label className="block text-gray-700 dark:text-gray-200 text-sm font-bold mb-2">
                Default AI Model
              </label>
              <div className="relative">
                <select
                  value={selectedModel}
                  onChange={(e) => {
                    setSelectedModel(e.target.value);
                    const selectedModelInfo = models.find(model => model.id === e.target.value);
                    setModelInfo(selectedModelInfo?.description || "");
                    setSettingsSaved(false);
                  }}
                  className="block appearance-none w-full bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-700 text-gray-700 dark:text-gray-200 py-3 px-4 pr-8 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent text-base"
                >
                  {models.map((model) => (
                    <option key={model.id} value={model.id}>
                      {model.name}
                    </option>
                  ))}
                </select>
                <div className="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700 dark:text-gray-200">
                  <svg className="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
                    <path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z" />
                  </svg>
                </div>
              </div>
              {modelInfo && (
                <div className="mt-2 text-sm text-gray-600 dark:text-gray-400">
                  {modelInfo}
                </div>
              )}
            </div>
          </div>
          )}
          
          {activeTab === 'generator' && (
          <div className="bg-white dark:bg-gray-800 rounded-xl shadow-md p-6 mb-6">
            <h2 className="text-xl font-semibold mb-4 text-gray-800 dark:text-white">
              Base Prompt
            </h2>
            
            <div className="bg-gray-100 dark:bg-gray-700 rounded-lg p-4 min-h-[80px] mb-4 text-gray-800 dark:text-gray-200 border border-gray-200 dark:border-gray-600">
              {generatedPrompt || "Your prompt will appear here once you make your selections..."}
            </div>
            
            <div className="text-sm text-gray-600 dark:text-gray-400 mb-4">
              Using {models.find(model => model.id === selectedModel)?.name || 'selected model'} for enhancement
            </div>
            
            <button
              onClick={enhancePromptWithAI}
              disabled={isLoading}
              className={`w-full py-3 px-4 rounded-lg text-white font-medium transition-colors ${
                isLoading 
                  ? 'bg-gray-400 cursor-not-allowed' 
                  : 'bg-primary hover:bg-primary/90'
              }`}
            >
              {isLoading ? 'Enhancing Prompt...' : 'Enhance with AI'}
            </button>
          </div>
          )}
          
          {error && (
            <div className="bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-200 p-4 rounded-lg mb-6">
              {error}
            </div>
          )}
          
          {(enhancedPrompt || generatedPrompt) && (
            <div className="bg-white dark:bg-gray-800 rounded-xl shadow-md p-6">
              <h2 className="text-xl font-semibold mb-4 text-gray-800 dark:text-white">
                {enhancedPrompt ? 'Generated Prompt' : 'Generated Prompt'}
              </h2>
              
              <div className="bg-gray-100 dark:bg-gray-700 rounded-lg p-4 min-h-[100px] mb-4 text-gray-800 dark:text-gray-200 border border-gray-200 dark:border-gray-600">
                {enhancedPrompt || generatedPrompt}
              </div>
              
              <div className="flex flex-col sm:flex-row gap-3">
                <button
                  onClick={copyToClipboard}
                  className={`flex-1 py-3 px-4 rounded-lg text-white font-medium transition-colors ${
                    copySuccess 
                      ? 'bg-green-500 hover:bg-green-600' 
                      : 'bg-primary hover:bg-primary/90'
                  }`}
                >
                  {copySuccess ? 'Copied!' : 'Copy Prompt'}
                </button>
                
                <button
                  onClick={addToFavorites}
                  className="flex-1 py-3 px-4 rounded-lg bg-yellow-500 hover:bg-yellow-600 text-white font-medium transition-colors"
                >
                  Add to Favorites
                </button>
                
                <button
                  onClick={generatePreview}
                  disabled={isLoadingPreview}
                  className={`flex-1 py-3 px-4 rounded-lg text-white font-medium transition-colors ${
                    isLoadingPreview 
                      ? 'bg-gray-400 cursor-not-allowed' 
                      : 'bg-green-600 hover:bg-green-700'
                  }`}
                >
                  {isLoadingPreview ? 'Loading...' : 'Preview Response'}
                </button>
              </div>
            </div>
          )}
          
          {/* Favorites Tab Content */}
          {activeTab === 'favorites' && (
            <div className="space-y-4">
              <div className="flex justify-between items-center mb-4">
                <h2 className="text-xl font-semibold text-gray-800 dark:text-white">
                  Favorite Prompts
                </h2>
                <button 
                  onClick={() => exportPrompts('favorites')}
                  className="px-3 py-1 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-200 rounded-lg text-sm hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors"
                >
                  Export as JSON
                </button>
              </div>
              
              {favorites.length === 0 ? (
                <div className="bg-white dark:bg-gray-800 rounded-xl shadow-md p-6 text-center">
                  <p className="text-gray-500 dark:text-gray-400">
                    You haven't saved any favorite prompts yet.
                  </p>
                  <p className="text-gray-500 dark:text-gray-400 mt-2">
                    When you generate a prompt you like, use the "Add to Favorites" button to save it here.
                  </p>
                </div>
              ) : (
                <div className="space-y-4">
                  {favorites.map(item => (
                    <PromptCard
                      key={item.id}
                      item={item}
                      isFavorite={true}
                      onLoad={loadSavedPrompt}
                      onToggleFavorite={() => removeFromFavorites(item.id)}
                    />
                  ))}
                </div>
              )}
            </div>
          )}
          
          {/* History Tab Content */}
          {activeTab === 'history' && (
          <div className="space-y-4">
            <div className="flex justify-between items-center mb-4">
              <h2 className="text-xl font-semibold text-gray-800 dark:text-white">
                Prompt History
              </h2>
              <button 
                onClick={() => exportPrompts('history')}
                className="px-3 py-1 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-200 rounded-lg text-sm hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors"
              >
                Export as JSON
              </button>
            </div>
            
            {promptHistory.length === 0 ? (
              <div className="bg-white dark:bg-gray-800 rounded-xl shadow-md p-6 text-center">
                <p className="text-gray-500 dark:text-gray-400">
                  You haven't generated any prompts yet.
                </p>
                <p className="text-gray-500 dark:text-gray-400 mt-2">
                  When you generate a prompt, it will appear here.
                </p>
              </div>
            ) : (
              <div className="space-y-4">
                {promptHistory.map(item => (
                  <PromptCard
                    key={item.id}
                    item={item}
                    isFavorite={favorites.some(fav => fav.id === item.id)}
                    onLoad={loadSavedPrompt}
                    onToggleFavorite={() => {
                      if (favorites.some(fav => fav.id === item.id)) {
                        removeFromFavorites(item.id);
                      } else {
                        // Reuse the existing addToFavorites logic but with the history item
                        const newFavorite = { ...item };
                        const updatedFavorites = [...favorites, newFavorite];
                        setFavorites(updatedFavorites);
                        localStorage.setItem('prompt_favorites', JSON.stringify(updatedFavorites));
                      }
                    }}
                    onDelete={removeFromHistory}
                    isHistory={true}
                  />
                ))}
              </div>
            )}
          </div>
          )}
          
          {/* Validate Tab Content */}
          {activeTab === 'validate' && (
            <div className="bg-white dark:bg-gray-800 rounded-xl shadow-md p-6 mb-6">
              <h2 className="text-xl font-semibold mb-4 text-gray-800 dark:text-white">
                Prompt &amp; Response Validation
              </h2>
              
              <div className="mb-4">
                <label className="block text-gray-700 dark:text-gray-200 text-sm font-bold mb-2">
                  Prompt
                </label>
                <textarea
                  id="validate-prompt"
                  placeholder="Enter the prompt you want to validate..."
                  className="w-full bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-700 text-gray-700 dark:text-gray-200 py-3 px-4 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent text-base min-h-[100px]"
                />
              </div>
              
              <div className="mb-4 flex justify-center">
                <button
                  onClick={() => {
                    // Get the prompt text
                    const promptText = document.getElementById('validate-prompt').value.trim();
                    if (!promptText) {
                      setError("Please enter a prompt first.");
                      return;
                    }
                    if (!apiKey) {
                      setError("Please enter your OpenRouter API key in the API Settings section and save it.");
                      return;
                    }
                    
                    // Set loading state
                    setIsLoading(true);
                    setError("");
                    
                    // Generate response using the API
                    fetch('https://openrouter.ai/api/v1/chat/completions', {
                      method: 'POST',
                      headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiKey}`,
                        'HTTP-Referer': window.location.href,
                        'X-Title': 'Prompt Generator App'
                      },
                      body: JSON.stringify({
                        model: selectedModel,
                        messages: [
                          {
                            role: "user",
                            content: promptText
                          }
                        ],
                        max_tokens: 1000
                      })
                    })
                    .then(response => {
                      if (!response.ok) {
                        throw new Error(`API error: ${response.status} ${response.statusText}`);
                      }
                      return response.json();
                    })
                    .then(data => {
                      // Set the response in the textarea
                      const responseField = document.getElementById('validate-response');
                      if (responseField) {
                        responseField.value = data.choices[0].message.content;
                        // Force the browser to register the change
                        const event = new Event('input', { bubbles: true });
                        responseField.dispatchEvent(event);
                      }
                    })
                    .catch(err => {
                      console.error('Response generation error:', err);
                      setError(`Error generating response: ${err.message}`);
                    })
                    .finally(() => {
                      setIsLoading(false);
                    });
                  }}
                  className="px-6 py-2 bg-green-600 hover:bg-green-700 text-white font-medium rounded-lg transition-colors"
                >
                  Generate Response
                </button>
              </div>
              
              <div className="mb-4">
                <label className="block text-gray-700 dark:text-gray-200 text-sm font-bold mb-2">
                  LLM Response
                </label>
                <textarea
                  id="validate-response"
                  placeholder="Enter the LLM response you want to validate..."
                  className="w-full bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-700 text-gray-700 dark:text-gray-200 py-3 px-4 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent text-base min-h-[150px]"
                />
              </div>
              
              <div className="mb-6">
                <label className="block text-gray-700 dark:text-gray-200 text-sm font-bold mb-2">
                  Validation Criteria
                </label>
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <div className="flex items-center">
                    <input
                      type="checkbox"
                      id="factual-accuracy"
                      className="w-4 h-4 text-primary border-gray-300 rounded"
                      defaultChecked
                    />
                    <label htmlFor="factual-accuracy" className="ml-2 block text-sm text-gray-700 dark:text-gray-200">
                      Factual Accuracy
                    </label>
                  </div>
                  <div className="flex items-center">
                    <input
                      type="checkbox"
                      id="relevance"
                      className="w-4 h-4 text-primary border-gray-300 rounded"
                      defaultChecked
                    />
                    <label htmlFor="relevance" className="ml-2 block text-sm text-gray-700 dark:text-gray-200">
                      Relevance to Prompt
                    </label>
                  </div>
                  <div className="flex items-center">
                    <input
                      type="checkbox"
                      id="bias"
                      className="w-4 h-4 text-primary border-gray-300 rounded"
                      defaultChecked
                    />
                    <label htmlFor="bias" className="ml-2 block text-sm text-gray-700 dark:text-gray-200">
                      Bias Detection
                    </label>
                  </div>
                  <div className="flex items-center">
                    <input
                      type="checkbox"
                      id="consistency"
                      className="w-4 h-4 text-primary border-gray-300 rounded"
                      defaultChecked
                    />
                    <label htmlFor="consistency" className="ml-2 block text-sm text-gray-700 dark:text-gray-200">
                      Internal Consistency
                    </label>
                  </div>
                  <div className="flex items-center">
                    <input
                      type="checkbox"
                      id="clarity"
                      className="w-4 h-4 text-primary border-gray-300 rounded"
                      defaultChecked
                    />
                    <label htmlFor="clarity" className="ml-2 block text-sm text-gray-700 dark:text-gray-200">
                      Clarity &amp; Coherence
                    </label>
                  </div>
                  <div className="flex items-center">
                    <input
                      type="checkbox"
                      id="hallucination"
                      className="w-4 h-4 text-primary border-gray-300 rounded"
                      defaultChecked
                    />
                    <label htmlFor="hallucination" className="ml-2 block text-sm text-gray-700 dark:text-gray-200">
                      Hallucination Detection
                    </label>
                  </div>
                </div>
              </div>
              
              <button
                id="validate-button"
                onClick={() => validateResponse()}
                className="w-full py-3 px-4 rounded-lg bg-primary hover:bg-primary/90 text-white font-medium transition-colors"
              >
                Validate Response
              </button>
            </div>
          )}
          
          {activeTab === 'validate' && (
            <div id="validation-results" className="bg-white dark:bg-gray-800 rounded-xl shadow-md p-6 mb-6 hidden">
              <h2 className="text-xl font-semibold mb-4 text-gray-800 dark:text-white">
                Validation Results
              </h2>
              
              <div id="results-container" className="space-y-4">
                {/* Results will be inserted here dynamically */}
              </div>
              
              <div className="mt-6 p-4 bg-blue-50 dark:bg-blue-900 text-blue-800 dark:text-blue-200 rounded-lg">
                <h3 className="font-medium mb-2">Recommendations:</h3>
                <ul id="recommendations-list" className="list-disc pl-5 space-y-1">
                  {/* Recommendations will be inserted here dynamically */}
                </ul>
              </div>
            </div>
          )}
          
          <div className="mt-8 text-center text-gray-500 dark:text-gray-400 text-sm">
            Make your selections and add a seed prompt to generate the perfect prompt, enhanced by AI.
          </div>
          
          {/* Custom Field Modal */}
          {showCustomModal && (
            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
              <div className="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 max-w-md w-full">
                <h3 className="text-xl font-semibold mb-4 text-gray-800 dark:text-white">
                  Add Custom {customType === 'role' ? 'Role' : customType === 'task' ? 'Task' : 'Format'}
                </h3>
                
                <div className="mb-4">
                  <label className="block text-gray-700 dark:text-gray-200 text-sm font-bold mb-2">
                    Name
                  </label>
                  <input
                    type="text"
                    value={customValue}
                    onChange={(e) => setCustomValue(e.target.value)}
                    placeholder={`Enter a custom ${customType}...`}
                    className="w-full bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-700 text-gray-700 dark:text-gray-200 py-3 px-4 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent text-base"
                  />
                </div>
                
                <div className="flex justify-end space-x-3">
                  <button
                    onClick={() => setShowCustomModal(false)}
                    className="px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-200 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors"
                  >
                    Cancel
                  </button>
                  <button
                    onClick={addCustomField}
                    disabled={!customValue.trim()}
                    className={`px-4 py-2 rounded-lg text-white font-medium transition-colors ${
                      customValue.trim() ? 'bg-primary hover:bg-primary/90' : 'bg-gray-400 cursor-not-allowed'
                    }`}
                  >
                    Add
                  </button>
                </div>
              </div>
            </div>
          )}
          
          {/* Preview Modal */}
          {showPreview && (
            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
              <div className="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 max-w-2xl w-full">
                <div className="flex justify-between items-center mb-4">
                  <h3 className="text-xl font-semibold text-gray-800 dark:text-white">
                    Prompt Preview Response
                  </h3>
                  <button
                    onClick={() => setShowPreview(false)}
                    className="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200"
                  >
                    <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                    </svg>
                  </button>
                </div>
                
                <div className="bg-gray-100 dark:bg-gray-700 rounded-lg p-4 mb-4 text-gray-800 dark:text-gray-200 border border-gray-200 dark:border-gray-600 max-h-96 overflow-y-auto">
                  {previewResponse}
                </div>
                
                <div className="flex justify-end">
                  <button
                    onClick={() => setShowPreview(false)}
                    className="px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary/90 transition-colors"
                  >
                    Close
                  </button>
                </div>
              </div>
            </div>
          )}
        </div>
      );
    };
    
    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>

</html>
