<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LLM Response Comparator</title>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            primary: '#3B82F6',
            secondary: '#8B5CF6',
          },
        },
      },
    }
    
    // Check for dark mode preference
    if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
      document.documentElement.classList.add('dark');
    }
    
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
      if (event.matches) {
        document.documentElement.classList.add('dark');
      } else {
        document.documentElement.classList.remove('dark');
      }
    });
  </script>
</head>
<body class="bg-gray-50 dark:bg-gray-900 min-h-screen">
  <div id="root"></div>
  
  <script type="text/babel">
    // Cookie utility functions
    const setCookie = (name, value, days = 365) => {
      const date = new Date();
      date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
      const expires = `expires=${date.toUTCString()}`;
      document.cookie = `${name}=${value};${expires};path=/;SameSite=Strict`;
    };

    const getCookie = (name) => {
      const cookieName = `${name}=`;
      const cookies = document.cookie.split(';');
      for (let i = 0; i < cookies.length; i++) {
        let cookie = cookies[i].trim();
        if (cookie.indexOf(cookieName) === 0) {
          return cookie.substring(cookieName.length, cookie.length);
        }
      }
      return "";
    };

    const App = () => {
      // Available models
      const models = [
        {
          id: "anthropic/claude-3-haiku",
          name: "Claude 3 Haiku",
          description: "Fast and cost-effective",
          color: "bg-orange-500"
        },
        {
          id: "anthropic/claude-3-sonnet",
          name: "Claude 3 Sonnet",
          description: "Balanced performance",
          color: "bg-orange-600"
        },
        {
          id: "anthropic/claude-3-opus",
          name: "Claude 3 Opus",
          description: "Most powerful Claude",
          color: "bg-orange-700"
        },
        {
          id: "openai/gpt-4o",
          name: "GPT-4o",
          description: "OpenAI's flagship",
          color: "bg-green-500"
        },
        {
          id: "openai/gpt-4o-mini",
          name: "GPT-4o Mini",
          description: "Faster, smaller GPT-4o",
          color: "bg-green-600"
        },
        {
          id: "google/gemini-1.5-pro",
          name: "Gemini 1.5 Pro",
          description: "Google's advanced model",
          color: "bg-blue-500"
        },
        {
          id: "mistralai/mistral-large",
          name: "Mistral Large",
          description: "Powerful European model",
          color: "bg-purple-500"
        },
        {
          id: "meta-llama/llama-3.1-8b-instruct",
          name: "Llama 3.1 8B",
          description: "Open source efficiency",
          color: "bg-red-500"
        }
      ];

      // State management
      const [apiKey, setApiKey] = React.useState(() => getCookie('openrouter_api_key') || "");
      const [prompt, setPrompt] = React.useState("");
      const [selectedModels, setSelectedModels] = React.useState(() => {
        const saved = getCookie('selected_models_comparator');
        return saved ? JSON.parse(saved) : [models[0].id, models[3].id];
      });
      const [responses, setResponses] = React.useState({});
      const [isLoading, setIsLoading] = React.useState({});
      const [error, setError] = React.useState("");
      const [settingsSaved, setSettingsSaved] = React.useState(!!getCookie('openrouter_api_key'));
      const [activeTab, setActiveTab] = React.useState('compare');
      const [comparisons, setComparisons] = React.useState(() => {
        const saved = localStorage.getItem('comparisons_history');
        return saved ? JSON.parse(saved) : [];
      });
      const [showSettings, setShowSettings] = React.useState(false);

      // Performance tracking
      const [performance, setPerformance] = React.useState({});

      // Save settings
      const saveSettings = () => {
        setCookie('openrouter_api_key', apiKey);
        setCookie('selected_models_comparator', JSON.stringify(selectedModels));
        setSettingsSaved(true);
        setShowSettings(false);
      };

      // Model selection handler
      const handleModelToggle = (modelId) => {
        setSelectedModels(prev => {
          if (prev.includes(modelId)) {
            return prev.filter(id => id !== modelId);
          } else if (prev.length < 4) { // Limit to 4 models for layout
            return [...prev, modelId];
          }
          return prev;
        });
        setSettingsSaved(false);
      };

      // API call function
      const callModel = async (modelId, userPrompt) => {
        const startTime = Date.now();
        
        try {
          const response = await fetch('https://openrouter.ai/api/v1/chat/completions', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Authorization': `Bearer ${apiKey}`,
              'HTTP-Referer': window.location.href,
              'X-Title': 'LLM Response Comparator'
            },
            body: JSON.stringify({
              model: modelId,
              messages: [
                {
                  role: "user",
                  content: userPrompt
                }
              ],
              max_tokens: 1000
            })
          });

          if (!response.ok) {
            const errorData = await response.json().catch(() => ({}));
            throw new Error(
              errorData.error?.message || 
              `API error: ${response.status} ${response.statusText}`
            );
          }

          const data = await response.json();
          const endTime = Date.now();
          const responseTime = endTime - startTime;

          // Track performance
          setPerformance(prev => ({
            ...prev,
            [modelId]: {
              responseTime,
              tokens: data.usage?.total_tokens || 0,
              timestamp: new Date().toISOString()
            }
          }));

          return {
            content: data.choices[0].message.content,
            usage: data.usage,
            responseTime
          };
        } catch (err) {
          const endTime = Date.now();
          setPerformance(prev => ({
            ...prev,
            [modelId]: {
              responseTime: endTime - startTime,
              error: err.message,
              timestamp: new Date().toISOString()
            }
          }));
          throw err;
        }
      };

      // Run comparison
      const runComparison = async () => {
        if (!apiKey) {
          setError("Please enter your OpenRouter API key and save settings.");
          return;
        }

        if (!prompt.trim()) {
          setError("Please enter a prompt to compare.");
          return;
        }

        if (selectedModels.length < 2) {
          setError("Please select at least 2 models to compare.");
          return;
        }

        setError("");
        setResponses({});
        setPerformance({});
        
        // Set loading state for all selected models
        const loadingState = {};
        selectedModels.forEach(modelId => {
          loadingState[modelId] = true;
        });
        setIsLoading(loadingState);

        // Run all comparisons in parallel
        const promises = selectedModels.map(async (modelId) => {
          try {
            const result = await callModel(modelId, prompt);
            setResponses(prev => ({
              ...prev,
              [modelId]: result.content
            }));
            setIsLoading(prev => ({
              ...prev,
              [modelId]: false
            }));
          } catch (err) {
            console.error(`Error with ${modelId}:`, err);
            setResponses(prev => ({
              ...prev,
              [modelId]: `Error: ${err.message}`
            }));
            setIsLoading(prev => ({
              ...prev,
              [modelId]: false
            }));
          }
        });

        await Promise.all(promises);

        // Save to history
        const comparison = {
          id: Date.now(),
          prompt,
          models: selectedModels,
          responses: {},
          performance: {},
          timestamp: new Date().toISOString()
        };

        // Will be updated with actual responses
        setTimeout(() => {
          setComparisons(prev => {
            const updated = [{
              ...comparison,
              responses: { ...responses },
              performance: { ...performance }
            }, ...prev].slice(0, 20);
            localStorage.setItem('comparisons_history', JSON.stringify(updated));
            return updated;
          });
        }, 1000);
      };

      // Load comparison from history
      const loadComparison = (comparison) => {
        setPrompt(comparison.prompt);
        setSelectedModels(comparison.models);
        setResponses(comparison.responses);
        setPerformance(comparison.performance);
        setActiveTab('compare');
      };

      // Export comparison results
      const exportResults = () => {
        const data = {
          prompt,
          timestamp: new Date().toISOString(),
          models: selectedModels.map(id => ({
            id,
            name: models.find(m => m.id === id)?.name
          })),
          responses,
          performance
        };
        
        const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `llm_comparison_${new Date().toISOString().split('T')[0]}.json`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      };

      // Copy response to clipboard
      const copyResponse = async (text, modelId) => {
        try {
          await navigator.clipboard.writeText(text);
          // Could add a temporary success indicator here
        } catch (err) {
          console.error('Failed to copy text: ', err);
        }
      };

      // Tab component
      const TabButton = ({ active, onClick, children, badge }) => (
        <button
          onClick={onClick}
          className={`relative px-4 py-2 font-medium transition-colors rounded-lg ${
            active 
              ? 'bg-primary text-white' 
              : 'bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700'
          }`}
        >
          {children}
          {badge && (
            <span className="absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center">
              {badge}
            </span>
          )}
        </button>
      );

      // Response card component
      const ResponseCard = ({ modelId, response, isLoading, performance }) => {
        const model = models.find(m => m.id === modelId);
        const isError = response && response.startsWith('Error:');
        
        return (
          <div className="bg-white dark:bg-gray-800 rounded-xl shadow-md border border-gray-200 dark:border-gray-700">
            <div className="p-4 border-b border-gray-200 dark:border-gray-700">
              <div className="flex items-center justify-between">
                <div className="flex items-center space-x-3">
                  <div className={`w-3 h-3 rounded-full ${model?.color || 'bg-gray-400'}`}></div>
                  <div>
                    <h3 className="font-semibold text-gray-900 dark:text-white">
                      {model?.name || modelId}
                    </h3>
                    <p className="text-sm text-gray-500 dark:text-gray-400">
                      {model?.description}
                    </p>
                  </div>
                </div>
                {performance && !performance.error && (
                  <div className="text-right">
                    <div className="text-sm font-medium text-gray-900 dark:text-white">
                      {performance.responseTime}ms
                    </div>
                    {performance.tokens && (
                      <div className="text-xs text-gray-500 dark:text-gray-400">
                        {performance.tokens} tokens
                      </div>
                    )}
                  </div>
                )}
              </div>
            </div>
            
            <div className="p-4">
              {isLoading ? (
                <div className="flex items-center justify-center py-8">
                  <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-primary"></div>
                  <span className="ml-3 text-gray-600 dark:text-gray-400">Generating response...</span>
                </div>
              ) : response ? (
                <div>
                  <div className={`prose prose-sm max-w-none mb-4 ${
                    isError 
                      ? 'text-red-600 dark:text-red-400' 
                      : 'text-gray-800 dark:text-gray-200'
                  }`}>
                    <div className="whitespace-pre-wrap">{response}</div>
                  </div>
                  {!isError && (
                    <div className="flex justify-end">
                      <button
                        onClick={() => copyResponse(response, modelId)}
                        className="text-primary hover:text-primary/80 text-sm font-medium"
                      >
                        Copy Response
                      </button>
                    </div>
                  )}
                </div>
              ) : (
                <div className="text-center py-8 text-gray-500 dark:text-gray-400">
                  Response will appear here after running comparison
                </div>
              )}
            </div>
          </div>
        );
      };

      return (
        <div className="min-h-screen bg-gray-50 dark:bg-gray-900">
          {/* Header */}
          <header className="bg-white dark:bg-gray-800 shadow-sm border-b border-gray-200 dark:border-gray-700">
            <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
              <div className="flex justify-between items-center h-16">
                <div className="flex items-center space-x-4">
                  <h1 className="text-2xl font-bold text-gray-900 dark:text-white">
                    LLM Response Comparator
                  </h1>
                  <span className="px-2 py-1 bg-primary/10 text-primary text-xs font-medium rounded-full">
                    v1.0
                  </span>
                  <a 
              href="https://intelda-consultant.github.io/projects/llm-comparator-tutorial.html" 
              className="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors"
              target="_blank"
            >
              📖 Tutorial
            </a>
            <a 
              href="https://intelda.ca" 
              className="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors"
              target="_blank"
            >
              Back to Intelda.ca
            </a>
                </div>
                <div className="flex items-center space-x-4">
                  <button
                    onClick={() => setShowSettings(!showSettings)}
                    className={`p-2 rounded-lg transition-colors ${
                      showSettings ? 'bg-primary text-white' : 'bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600'
                    }`}
                  >
                    ⚙️
                  </button>
                  <button
                    onClick={() => document.documentElement.classList.toggle('dark')}
                    className="p-2 rounded-lg bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600"
                  >
                    🌙
                  </button>
                </div>
              </div>
            </div>
          </header>

          <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            {/* Settings Panel */}
            {showSettings && (
              <div className="mb-8 bg-white dark:bg-gray-800 rounded-xl shadow-md p-6">
                <div className="flex justify-between items-center mb-6">
                  <h2 className="text-xl font-semibold text-gray-900 dark:text-white">
                    Settings
                  </h2>
                  {settingsSaved && (
                    <span className="px-2 py-1 bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200 text-xs font-medium rounded-full">
                      Saved
                    </span>
                  )}
                </div>
                
                <div className="grid md:grid-cols-2 gap-8">
                  <div>
                    <label className="block text-gray-700 dark:text-gray-200 text-sm font-bold mb-2">
                      OpenRouter API Key
                    </label>
                    <div className="flex">
                      <input
                        type="password"
                        value={apiKey}
                        onChange={(e) => setApiKey(e.target.value)}
                        placeholder="Enter your OpenRouter API key"
                        className="flex-1 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-700 text-gray-700 dark:text-gray-200 py-3 px-4 rounded-l-lg focus:outline-none focus:ring-2 focus:ring-primary"
                      />
                      <button
                        onClick={saveSettings}
                        className="bg-green-500 hover:bg-green-600 text-white font-medium py-3 px-4 rounded-r-lg transition-colors"
                      >
                        Save
                      </button>
                    </div>
                  </div>
                  
                  <div>
                    <label className="block text-gray-700 dark:text-gray-200 text-sm font-bold mb-2">
                      Selected Models ({selectedModels.length}/4)
                    </label>
                    <div className="grid grid-cols-2 gap-2 max-h-40 overflow-y-auto">
                      {models.map(model => (
                        <label key={model.id} className="flex items-center space-x-2 cursor-pointer">
                          <input
                            type="checkbox"
                            checked={selectedModels.includes(model.id)}
                            onChange={() => handleModelToggle(model.id)}
                            className="rounded border-gray-300"
                            disabled={!selectedModels.includes(model.id) && selectedModels.length >= 4}
                          />
                          <div className="flex items-center space-x-2 min-w-0">
                            <div className={`w-2 h-2 rounded-full ${model.color}`}></div>
                            <span className="text-sm text-gray-700 dark:text-gray-200 truncate">
                              {model.name}
                            </span>
                          </div>
                        </label>
                      ))}
                    </div>
                  </div>
                </div>
              </div>
            )}

            {/* Navigation Tabs */}
            <div className="flex space-x-2 mb-6">
              <TabButton 
                active={activeTab === 'compare'} 
                onClick={() => setActiveTab('compare')}
              >
                Compare
              </TabButton>
              <TabButton 
                active={activeTab === 'history'} 
                onClick={() => setActiveTab('history')}
                badge={comparisons.length > 0 ? comparisons.length : null}
              >
                History
              </TabButton>
            </div>

            {/* Error Display */}
            {error && (
              <div className="mb-6 bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-200 p-4 rounded-lg">
                {error}
              </div>
            )}

            {/* Compare Tab */}
            {activeTab === 'compare' && (
              <>
                {/* Prompt Input */}
                <div className="mb-8 bg-white dark:bg-gray-800 rounded-xl shadow-md p-6">
                  <label className="block text-gray-700 dark:text-gray-200 text-sm font-bold mb-4">
                    Enter your prompt to compare across models:
                  </label>
                  <textarea
                    value={prompt}
                    onChange={(e) => setPrompt(e.target.value)}
                    placeholder="Enter your prompt here... (e.g., 'Explain quantum computing in simple terms')"
                    className="w-full bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-700 text-gray-700 dark:text-gray-200 py-4 px-4 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary min-h-[120px] resize-y"
                  />
                  
                  <div className="flex justify-between items-center mt-4">
                    <div className="text-sm text-gray-500 dark:text-gray-400">
                      Comparing across {selectedModels.length} models
                    </div>
                    <div className="flex space-x-3">
                      {Object.keys(responses).length > 0 && (
                        <button
                          onClick={exportResults}
                          className="px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white font-medium rounded-lg transition-colors"
                        >
                          Export Results
                        </button>
                      )}
                      <button
                        onClick={runComparison}
                        disabled={Object.values(isLoading).some(loading => loading)}
                        className={`px-6 py-2 rounded-lg text-white font-medium transition-colors ${
                          Object.values(isLoading).some(loading => loading)
                            ? 'bg-gray-400 cursor-not-allowed' 
                            : 'bg-primary hover:bg-primary/90'
                        }`}
                      >
                        {Object.values(isLoading).some(loading => loading) ? 'Comparing...' : 'Run Comparison'}
                      </button>
                    </div>
                  </div>
                </div>

                {/* Response Grid */}
                {selectedModels.length > 0 && (
                  <div className={`grid gap-6 ${
                    selectedModels.length === 1 ? 'grid-cols-1' :
                    selectedModels.length === 2 ? 'grid-cols-1 lg:grid-cols-2' :
                    selectedModels.length === 3 ? 'grid-cols-1 lg:grid-cols-2 xl:grid-cols-3' :
                    'grid-cols-1 lg:grid-cols-2'
                  }`}>
                    {selectedModels.map(modelId => (
                      <ResponseCard
                        key={modelId}
                        modelId={modelId}
                        response={responses[modelId]}
                        isLoading={isLoading[modelId]}
                        performance={performance[modelId]}
                      />
                    ))}
                  </div>
                )}
              </>
            )}

            {/* History Tab */}
            {activeTab === 'history' && (
              <div>
                <div className="flex justify-between items-center mb-6">
                  <h2 className="text-xl font-semibold text-gray-900 dark:text-white">
                    Comparison History
                  </h2>
                  {comparisons.length > 0 && (
                    <button
                      onClick={() => {
                        localStorage.removeItem('comparisons_history');
                        setComparisons([]);
                      }}
                      className="px-4 py-2 bg-red-600 hover:bg-red-700 text-white font-medium rounded-lg transition-colors"
                    >
                      Clear History
                    </button>
                  )}
                </div>

                {comparisons.length === 0 ? (
                  <div className="bg-white dark:bg-gray-800 rounded-xl shadow-md p-8 text-center">
                    <p className="text-gray-500 dark:text-gray-400 mb-2">
                      No comparison history yet.
                    </p>
                    <p className="text-gray-500 dark:text-gray-400">
                      Run your first comparison to see results here.
                    </p>
                  </div>
                ) : (
                  <div className="space-y-4">
                    {comparisons.map(comparison => (
                      <div key={comparison.id} className="bg-white dark:bg-gray-800 rounded-xl shadow-md p-6">
                        <div className="flex justify-between items-start mb-4">
                          <div className="flex-1">
                            <div className="flex items-center space-x-2 mb-2">
                              {comparison.models.map(modelId => {
                                const model = models.find(m => m.id === modelId);
                                return (
                                  <div key={modelId} className="flex items-center space-x-1">
                                    <div className={`w-2 h-2 rounded-full ${model?.color || 'bg-gray-400'}`}></div>
                                    <span className="text-xs text-gray-600 dark:text-gray-400">
                                      {model?.name || modelId}
                                    </span>
                                  </div>
                                );
                              })}
                            </div>
                            <p className="text-gray-800 dark:text-gray-200 text-sm bg-gray-50 dark:bg-gray-900 p-3 rounded">
                              {comparison.prompt}
                            </p>
                          </div>
                          <div className="ml-4 text-right">
                            <div className="text-xs text-gray-500 dark:text-gray-400 mb-2">
                              {new Date(comparison.timestamp).toLocaleDateString()}
                            </div>
                            <button
                              onClick={() => loadComparison(comparison)}
                              className="text-primary hover:text-primary/80 text-sm font-medium"
                            >
                              Load Comparison
                            </button>
                          </div>
                        </div>
                      </div>
                    ))}
                  </div>
                )}
              </div>
            )}
          </div>

          {/* Footer */}
          <footer className="mt-16 bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700">
            <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
              <div className="text-center text-gray-500 dark:text-gray-400">
                <p className="mb-2">
                  Compare AI model responses side-by-side to find the best fit for your needs.
                </p>
                <p className="text-sm">
                  Built with ❤️ for the AI community • Powered by OpenRouter
                </p>
              </div>
            </div>
          </footer>
        </div>
      );
    };
    
    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>
</html>
